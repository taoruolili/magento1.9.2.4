var MagegiantOneStepCheckout=Class.create();MagegiantOneStepCheckout.prototype={initialize:function(){this.blocks={},this.queueBlocks={},this.currentRequest="",this.queueRequest=[],this.initAjaxResponse()},setConfig:function(e){this.blockMapping=e.blockMapping,this.loadingClass=e.loadingClass,this.showNumber=e.showNumber,this.actionPattern=e.actionPattern,this.isUsedMorphEffect=e.isUsedMorphEffect,this.saveFormUrl=e.saveFormUrl},setActionPattern:function(e){this.actionPattern=e},initAjaxResponse:function(){Ajax.Responders.register({onComplete:function(e){403===e.transport.status&&document.location.reload()}})},setBlocks:function(e){$H(e.blocks).each(function(e){this._addBlock(e[0],e[1])}.bind(this))},_addBlock:function(e,t){"undefined"==typeof this.blocks[e]&&$$(t).each(function(t){this.blocks[e]=t}.bind(this))},saveFormData:function(e){var t=Form.serialize(e,!0),i={method:"post",parameters:t};new Ajax.Request(this.saveFormUrl,i)},applyMorphEffect:function(e,t,i,s){if(this.isUsedMorphEffect){e.effect&&e.effect.cancel();var s=s||Prototype.emptyFunction;e.effect=new Effect.Morph(e,{style:{height:t+"px"},duration:i,afterFinish:function(){delete e.effect,s()}})}else e.setStyle(0===t?{display:"none",height:0}:{height:""})},getHeightFromElement:function(e){var t=e.style.height,i=e.style.display,s=e.style.visibility;e.setStyle({height:"",display:"",visibility:"hidden"});var n=e.getHeight();return e.setStyle({height:t,display:i,visibility:s}),n},showMessage:function(e,t,i){"object"==typeof t&&t.length>0?t.each(function(t){this._appendMessage(e,t,i)}.bind(this)):"string"==typeof t&&this._appendMessage(e,t,i)},removeMessage:function(e,t){e.select("."+t).each(function(e){e.remove()})},_appendMessage:function(e,t,i){var s=null,n=e.select("."+i+" ol");if(0===n.length){var o=new Element("div");o.addClassName(i),o.appendChild(new Element("ol")),e.insertBefore(o,e.down()),s=o.down()}else s=n.first();var r=new Element("li");r.update(t),s.appendChild(r)},addOverlay:function(e,t){var i=new Element("div");i.addClassName(t),e.appendChild(i)},removeOverlay:function(e,t){e.select("."+t).each(function(e){e.remove()})},Request:function(e,t){var i=this._getActionFromUrl(e,this.actionPattern);this.addBlocksToQueue(i),""===this.currentRequest?this.newRequest(e,t):this.queueRequest.push([e,t])},newRequest:function(e,t){var i=this._getActionFromUrl(e,this.actionPattern),t=t||{},s=Object.extend({},t),n=this;s=Object.extend(s,{onComplete:function(e){n.onComplete(e,i),t.onComplete&&t.onComplete(e)}}),this.currentRequest=new Ajax.Request(e,s)},reRequest:function(e,t){this.newRequest(e,t)},_getActionFromUrl:function(e,t){var i=e.match(t);return i&&i[1]?i[1]:null},addBlocksToQueue:function(e){e&&this.blockMapping[e]&&this.blockMapping[e].each(function(e){if("undefined"==typeof this.queueBlocks[e]&&(this.queueBlocks[e]=0),this.blocks[e]){if(0===this.queueBlocks[e]){var t=this.blocks[e];"appendQueueBeforeFinish"in this.blocks[e]&&this.blocks[e].appendQueueBeforeFinish(),this.appendLoading(t),"appendQueueAfterFinish"in this.blocks[e]&&this.blocks[e].appendQueueAfterFinish()}this.queueBlocks[e]++}}.bind(this))},appendLoading:function(e,t){var i=t;i||(i=this.loadingClass),e.setStyle({position:"relative"});var s=new Element("div");s.addClassName(i),e.insertBefore(s,e.down())},onComplete:function(transport,action){try{eval("var response = "+transport.responseText)}catch(e){var response={blocks:{}}}if(this.removeBlockQueue(action,response),this.currentRequest="",this.queueRequest.length>0){this._emptyQueue();var args=this.queueRequest.shift();this.reRequest(args[0],args[1])}},removeBlockQueue:function(e,t){if(e&&this.blockMapping[e]){var t=t||{},i=t.blocks||{};this.blockMapping[e].each(function(e){this.blocks[e]&&(this.queueBlocks[e]--,0===this.queueBlocks[e]&&(i[e]&&this.blocks[e].update(i[e]),"removeQueueBeforeFinish"in this.blocks[e]&&this.blocks[e].removeQueueBeforeFinish(t),this.updateNumbers(),this.removeLoading(this.blocks[e]),"removeQueueAfterFinish"in this.blocks[e]&&this.blocks[e].removeQueueAfterFinish(t)))}.bind(this))}},removeLoading:function(e,t){var i=t;i||(i=this.loadingClass);var s="."+i;e.setStyle({position:""}),e.select(s).each(function(e){e.remove()})},_emptyQueue:function(){var e=[],t=[];this.queueRequest.reverse().each(function(i,s){var n=this._getActionFromUrl(i[0],this.actionPattern);-1===e.indexOf(n)?e.push(n):t.push(s)}.bind(this));var i=[];this.queueRequest.each(function(e,s){var n=this._getActionFromUrl(e[0],this.actionPattern);-1===t.indexOf(s)?i.push(e):this.removeBlockQueue(n)}.bind(this)),this.queueRequest=i.reverse()},updateNumbers:function(){if(this.showNumber){var e=1;$$(".one-step-checkout-number").each(function(t){return 0===t.up().getHeight()||t.next()&&0===t.next().getHeight()?!1:(t.update(e+". "),void e++)})}}};var MagegiantOneStepCheckoutPopup=Class.create();MagegiantOneStepCheckoutPopup.prototype={initialize:function(e){this.selector=$$(e.selector).first(),this.tinyBoxConfig=e.tinyBoxConfig,this.initObserver()},initObserver:function(){this.selector&&this.selector.observe("click",function(){this.showPopup()}.bind(this))},showPopup:function(){"object"==typeof this.tinyBoxConfig.html&&this.tinyBoxConfig.html.setStyle({display:""}),TINY2.box.show(this.tinyBoxConfig)},hidePopup:function(){TINY2.box.hide()}};var MagegiantOneStepCheckoutAuthentication=Class.create();MagegiantOneStepCheckoutAuthentication.prototype={initialize:function(e){this.popupContainer=$(e.popupContainer),this.loginContainer=$(e.loginContainer),this.forgotContainer=$(e.forgotContainer),this.forgotLink=$(e.forgotLink),this.backLink=$(e.backLink),this.loginUrl=e.loginUrl,this.forgotUrl=e.forgotUrl,this.loginSubmitBtn=$(e.loginSubmitBtn),this.forgotSubmitBtn=$(e.forgotSubmitBtn),this.loadingClass=e.loadingClass,this.errorClass=e.errorClass,this.successClass=e.successClass,this.mode="form_login",this.initObserver()},initObserver:function(){this.forgotLink.observe("click",function(){this.loginContainer.hide(),this.forgotContainer.show(),this.mode="form_forgot"}.bind(this)),this.backLink.observe("click",function(){this.forgotContainer.hide(),this.loginContainer.show(),this.mode="form_login"}.bind(this)),this.loginSubmitBtn.observe("click",function(){this._processLogin()}.bind(this)),this.forgotSubmitBtn.observe("click",function(){this._processForgotPw()}.bind(this)),document.observe("keypress",this.keypressHandler.bind(this))},keypressHandler:function(e){var t=e.keyCode||e.which;return 13==t?void("form_login"==this.mode?this._processLogin():"form_forgot"==this.mode&&this._processForgotPw()):void 0},_processLogin:function(){var e=this,t=this.loginContainer.down("form"),i=this.successClass,s=this.errorClass;if(t.validator=new Validation(t),t.select(".validation-advice").each(function(e){e.remove()}),t.validator.validate()){this._removeAllMessage(),MagegiantOneStepCheckout.appendLoading(t,this.loadingClass);var n={parameters:t.serialize(!0),onComplete:function(n){try{var o=n.responseText.evalJSON();o.success===!0?(MagegiantOneStepCheckout.showMessage(t,o.message,i),document.location.reload()):o.error&&(MagegiantOneStepCheckout.removeLoading(t,e.loadingClass),MagegiantOneStepCheckout.showMessage(t,o.error,s))}catch(r){}}};MagegiantOneStepCheckout.Request(this.loginUrl,n)}},_processForgotPw:function(){var e=this.forgotContainer.down("form"),t=this.successClass,i=this.errorClass;if(e.validator=new Validation(e),e.select(".validation-advice").each(function(e){e.remove()}),e.validator.validate()){this._removeAllMessage(),MagegiantOneStepCheckout.appendLoading(e);var s={parameters:e.serialize(!0),onComplete:function(s){try{var n=s.responseText.evalJSON();n.success===!0?MagegiantOneStepCheckout.showMessage(e,n.message,t):n.error&&MagegiantOneStepCheckout.showMessage(e,n.error,i),MagegiantOneStepCheckout.removeLoading(e)}catch(o){}}};MagegiantOneStepCheckout.Request(this.forgotUrl,s)}},_removeAllMessage:function(){MagegiantOneStepCheckout.removeMessage(this.loginContainer,this.errorClass),MagegiantOneStepCheckout.removeMessage(this.loginContainer,this.successClass),MagegiantOneStepCheckout.removeMessage(this.forgotContainer,this.errorClass),MagegiantOneStepCheckout.removeMessage(this.forgotContainer,this.successClass)}};var MagegiantOnestepcheckoutAddress=Class.create();MagegiantOnestepcheckoutAddress.prototype={initialize:function(e){this.addressContainer=$$(e.addressContainer).first(),this.saveAddressUrl=e.saveAddressUrl,this.billingAddress={},this.billingAddress.countryRegionData={},this.shippingAddress={},this.shippingAddress.countryRegionData={}},setBillingAddress:function(e){this.billingAddress.container=$$(e.container).first(),this.billingAddress.addressSelect=$$(e.addressSelect).first(),this.billingAddress.newAddressContainer=$$(e.newAddressContainer).first(),this.billingAddress.createAccountCheckbox=$$(e.createAccountCheckbox).first(),this.billingAddress.passwordContainer=$$(e.passwordContainer).first(),this.billingAddress.useSameAddressCheckbox=$$(e.useSameAddressCheckbox).first(),this.billingAddress.triggerElements=e.triggerElements,this.billingAddress.countryRegionElements=e.countryRegionElements,this.billingAddress.countrySelect=$(this.billingAddress.countryRegionElements.countrySelect),this.billingAddress.regionSelect=$(this.billingAddress.countryRegionElements.regionSelect),this.billingAddress.regionInput=$(this.billingAddress.countryRegionElements.regionInput)},setShippingAddress:function(e){this.shippingAddress.container=$$(e.container).first(),this.shippingAddress.addressSelect=$$(e.addressSelect).first(),this.shippingAddress.newAddressContainer=$$(e.newAddressContainer).first(),this.shippingAddress.triggerElements=e.triggerElements,this.shippingAddress.countryRegionElements=e.countryRegionElements,this.shippingAddress.countrySelect=$(this.billingAddress.countryRegionElements.countrySelect),this.shippingAddress.regionSelect=$(this.billingAddress.countryRegionElements.regionSelect),this.shippingAddress.regionInput=$(this.billingAddress.countryRegionElements.regionInput)},initAddress:function(){this._sameAddressProcess(this.billingAddress.useSameAddressCheckbox),this._processAddressSelect(this.billingAddress),this._processAddressSelect(this.shippingAddress)},initObserver:function(){var e=this.billingAddress.useSameAddressCheckbox,t=this.billingAddress.createAccountCheckbox,i=this.billingAddress.countrySelect,s=this.billingAddress.regionSelect,n=this.billingAddress.regionInput,o=this.billingAddress.triggerElements,r=this.billingAddress.addressSelect;e&&e.observe("change",function(e){this._sameAddressProcess(e),this.changeAddressFinish(),this._processAddressSelect(this.shippingAddress)}.bind(this)),t&&t.observe("change",function(e){this._createAccountProcess(e)}.bind(this)),i&&i.observe("change",function(){this.countrySelectChanged(this.billingAddress)}.bind(this)),s&&s.observe("change",function(){this.regionSelectChanged(this.billingAddress)}.bind(this)),n&&n.observe("change",function(){this.regionInputChanged(this.billingAddress)}.bind(this)),o&&o.each(function(e){var t=$(e);t&&t.observe("change",function(){this.triggerElementChanged(this.billingAddress)}.bind(this))}.bind(this)),r&&r.observe("change",function(){this._processAddressSelect(this.billingAddress),this.changeAddressFinish()}.bind(this));var a=this.shippingAddress.countrySelect,h=this.shippingAddress.regionSelect,c=this.shippingAddress.regionInput,d=this.shippingAddress.triggerElements,p=this.shippingAddress.addressSelect;a&&a.observe("change",function(){this.countrySelectChanged(this.shippingAddress)}.bind(this)),h&&h.observe("change",function(){this.regionSelectChanged(this.shippingAddress)}.bind(this)),c&&c.observe("change",function(){this.regionInputChanged(this.shippingAddress)}.bind(this)),d&&d.each(function(e){var t=$(e);t&&t.observe("change",function(){this.triggerElementChanged(this.shippingAddress)}.bind(this))}.bind(this)),p&&p.observe("change",function(){this._processAddressSelect(this.shippingAddress),this.changeAddressFinish()}.bind(this)),Form.getElements(this.addressContainer).each(function(e){var t=e.id;return e===this.billingAddress.useSameAddressCheckbox||-1!==this.billingAddress.triggerElements.indexOf(t)||-1!==this.shippingAddress.triggerElements.indexOf(t)?!1:void e.observe("change",function(){this.saveFormData()}.bind(this))}.bind(this))},_sameAddressProcess:function(e){if("object"==typeof e){var t=!1;t=e.target?e.target.checked:e.checked,t?this.hideShippingAddress():this.showShippingAddress()}},_createAccountProcess:function(e){if("object"==typeof e){var t=!1;t=e.target?e.target.checked:e.checked,t?this.showPasswordContainer():this.hidePasswordContainer()}},showPasswordContainer:function(){var e=this.billingAddress.passwordContainer;e.setStyle({display:""});var t=MagegiantOneStepCheckout.getHeightFromElement(e);MagegiantOneStepCheckout.applyMorphEffect(e,t,.3,function(){e.setStyle({height:""})})},hidePasswordContainer:function(){var e=this.billingAddress.passwordContainer;MagegiantOneStepCheckout.applyMorphEffect(e,0,.5,function(){e.setStyle({display:"none"})})},changeAddressFinish:function(){var e={},t="",i="";this.billingAddress.container&&(t=Form.serialize(this.billingAddress.container,!0)),this.shippingAddress.container&&(i=Form.serialize(this.shippingAddress.container,!0)),t&&(e=Object.extend(e,t)),i&&(e=Object.extend(e,i));var s={method:"post",parameters:e};MagegiantOneStepCheckout.Request(this.saveAddressUrl,s)},showShippingAddress:function(){var e=this.shippingAddress.container;e.setStyle({display:""});var t=MagegiantOneStepCheckout.getHeightFromElement(e);MagegiantOneStepCheckout.applyMorphEffect(e,t,.3,function(){e.setStyle({height:""}),MagegiantOneStepCheckout.updateNumbers()})},hideShippingAddress:function(){var e=this.shippingAddress.container;MagegiantOneStepCheckout.applyMorphEffect(e,0,.5,function(){e.setStyle({display:"none"}),MagegiantOneStepCheckout.updateNumbers()})},countrySelectChanged:function(e){var t=e.countryRegionData[e.countrySelect.getValue()];t&&("regionSelect"===t.type?e.regionSelect.setValue(t.value):e.regionInput.setValue(t.value))},regionSelectChanged:function(e){e.countryRegionData[e.countrySelect.getValue()]={type:"regionSelect",value:e.regionSelect.getValue()}},regionInputChanged:function(e){e.countryRegionData[e.countrySelect.getValue()]={type:"regionInput",value:e.regionInput.getValue()}},triggerElementChanged:function(e){var t=e.triggerElements.all(function(e){var t=$(e);if(t){var i=$w(t.className);return i.all(function(e){var i=Validation.get(e);try{return Validation.isVisible(t)&&!i.test($F(t),t)?!1:!0}catch(s){return!0}})}},this);t&&this.changeAddressFinish()},_processAddressSelect:function(e){e.addressSelect&&(e.addressSelect.value?this.hideNewAddressContainer(e):this.showNewAddressContainer(e))},showNewAddressContainer:function(e){var t=e.newAddressContainer;t.setStyle({display:""});var i=MagegiantOneStepCheckout.getHeightFromElement(t);MagegiantOneStepCheckout.applyMorphEffect(t,i,.3,function(){e.container.setStyle({height:""})}.bind(this))},hideNewAddressContainer:function(e){var t=e.newAddressContainer;MagegiantOneStepCheckout.applyMorphEffect(t,0,.5,function(){t.setStyle({display:"none"})}.bind(this))},saveFormData:function(){MagegiantOneStepCheckout.saveFormData(this.addressContainer)}},MagegiantOnestepcheckoutAddressDetect=Class.create(),MagegiantOnestepcheckoutAddressDetect.prototype={initialize:function(e){this.inputSelector=$(e.inputSelector),this.componentForm=e.componentForm,this.addressType=e.addressType,this.addressElementsIds=e.addressElementsIds,this.regionUpdater=e.regionUpdater,this.giantOSCAddress=e.giantOSCAddress,this.geolocation=$(e.geolocation),this.specificCountry=e.specificCountry,this.initGoogleAutoComplete()},initGoogleAutoComplete:function(){var e=this;if(this.inputSelector){var t={types:["geocode"]};if(this.specificCountry){var i={componentRestrictions:{country:this.specificCountry}};t=Object.extend(t,i)}this.googleAutoComplete=new google.maps.places.Autocomplete(this.inputSelector,t),google.maps.event.addListener(this.googleAutoComplete,"place_changed",function(){e.googleResponse(e.googleAutoComplete.getPlace())})}this.geolocation&&this.geolocation.observe("click",function(){this.geoLocate()}.bind(this))},googleResponse:function(e){for(var t,i,s,n,o,r,a=0;a<e.address_components.length;a++){var h=e.address_components[a].types[0];this.componentForm[h]&&("street_number"==h&&(t&&e.address_components[a][this.componentForm.street_number]?t+=", "+e.address_components[a][this.componentForm.street_number]:t=e.address_components[a][this.componentForm.street_number]),"route"==h&&(t&&e.address_components[a][this.componentForm.route]?t+=" "+e.address_components[a][this.componentForm.route]:t=e.address_components[a][this.componentForm.route]),"neighborhood"==h&&(t&&e.address_components[a][this.componentForm.neighborhood]?t+=", "+e.address_components[a][this.componentForm.neighborhood]:t=e.address_components[a][this.componentForm.neighborhood]),"administrative_area_level_2"==h&&(t&&e.address_components[a][this.componentForm.administrative_area_level_2]?t+=", "+e.address_components[a][this.componentForm.administrative_area_level_2]:t=e.address_components[a][this.componentForm.administrative_area_level_2]),"locality"==h&&(i=e.address_components[a][this.componentForm.locality]),"administrative_area_level_1"==h&&(s=e.address_components[a].short_name,n=e.address_components[a].long_name),"country"==h&&(o=e.address_components[a][this.componentForm.country]),"postal_code"==h&&(r=e.address_components[a][this.componentForm.postal_code]))}this.responseComponents={street1:t,city:i,region_id:s,region:n,country_id:o,postcode:r},this.fillAddressById()},fillAddressById:function(){var e=this,t=this.giantOSCAddress.billingAddress,i=this.giantOSCAddress.shippingAddress;this.addressElementsIds.each(function(t){var i=$(e.addressType+":"+t);i&&e.responseComponents[t]&&(i.value=e.responseComponents[t])}),this.regionUpdater&&this.regionUpdater.update(),this.giantOSCAddress.triggerElementChanged("billing"==this.addressType?t:i)},geoLocate:function(){if(navigator.geolocation){var e=this;navigator.geolocation.getCurrentPosition(function(t){e.getAddressBytLatitude(t.coords.latitude,t.coords.longitude)})}},getAddressBytLatitude:function(e,t){var i=this,s=new google.maps.Geocoder,n=new google.maps.LatLng(e,t);s.geocode({latLng:n},function(e,t){return t!=google.maps.GeocoderStatus.OK?!1:void i.googleResponse(e[0])})}},MagegiantOnestepcheckoutShippingMethod=Class.create(),MagegiantOnestepcheckoutShippingMethod.prototype={initialize:function(e){this.shipingMethodContainer=$$(e.shipingMethodContainer).first(),this.shippingMethodElements=$$(e.shippingMethodElements),this.shippingMethodAdvice=$$(e.shippingMethodAdvice).first(),this.saveShippingMethodUrl=e.saveShippingMethodUrl,window.shippingMethod={},window.shippingMethod.validator=null,this.initObserver()},initObserver:function(){this.shippingMethodElements.each(function(e){e.observe("click",function(){this.removeValidationAdvice(),this.saveShippingMethod(e.value)}.bind(this))}.bind(this))},saveShippingMethod:function(e){if(this.currentMethod!==e){var t=Form.serialize(this.shipingMethodContainer,!0);MagegiantOneStepCheckout.Request(this.saveShippingMethodUrl,{method:"post",parameters:t}),this.currentMethod=e}},removeValidationAdvice:function(){this.shippingMethodAdvice&&this.shippingMethodAdvice.update("").hide()}},MagegiantOnestepcheckoutPaymentMethod=Class.create(),MagegiantOnestepcheckoutPaymentMethod.prototype={initialize:function(e){this.paymentMethodContainer=$$(e.paymentMethodContainer).first(),this.paymentMethodWrapper=$$(e.paymentMethodWrapper).first(),this.paymentMethodElements=$$(e.paymentMethodElements),this.paymentMethodAdvice=$$(e.paymentMethodAdvice).first(),this.savePaymentMethodUrl=e.savePaymentMethodUrl,this.cvv={container:$$(e.cvv.container).first(),showEl:$$(e.cvv.showEl).first(),hideEl:$$(e.cvv.hideEl).first()},this.initPayment(),this.initObserver()},initPayment:function(){this.paymentMethodElements.each(function(e){var t=e.value,i=$("payment_form_"+t);i&&i.setStyle({overflow:"hidden",display:"none"}),e.checked?(this.changeVisible(t,!1),this.currentMethod=t):this.changeVisible(t,!0)}.bind(this))},initObserver:function(){var e=this;this.paymentMethodElements.each(function(t){t.observe("click",function(){this.removeValidationAdvice(),this.switchMethod(t.value)}.bind(this));var i="payment_form_"+t.value;[i+"_before",i,i+"_after"].each(function(t){var i=$(t);i&&Form.getElements(i).each(function(t){t.observe("change",function(){e.savePaymentMethod(),Validation.reset(t)})}.bind(this))})}.bind(this));var t=this.cvv.showEl,i=this.cvv.hideEl;t&&t.observe("click",function(e){this.toogleCvvTooltip(e,!0)}.bind(this)),i&&i.observe("click",function(e){this.toogleCvvTooltip(e,!1)}.bind(this)),this.paymentMethodWrapper.appendQueueAfterFinish||(this.paymentMethodWrapper.appendQueueAfterFinish=function(){this.storeValues={},Form.getElements(this.paymentMethodWrapper).each(function(e){var t=e.id;t in this.storeValues&&e.setValue(this.storeValues[t])}.bind(this))}.bind(this)),this.paymentMethodWrapper.removeQueueAfterFinish||(this.paymentMethodWrapper.removeQueueAfterFinish=function(){Form.getElements(this.paymentMethodWrapper).each(function(e){var t=e.id;t in this.storeValues&&e.setValue(this.storeValues[t])}.bind(this)),this.storeValues={}}.bind(this))},removeValidationAdvice:function(){this.paymentMethodAdvice&&this.paymentMethodAdvice.update("").hide()},toogleCvvTooltip:function(e,t){this.cvv.container&&this.cvv.container.setStyle(t?{display:"",top:Event.pointerY(e)+40+"px"}:{display:"none"}),e.stop()},switchMethod:function(e){var t=!0;if("customercredit"===e){t=!1;var i=$("p_method_customercredit");i&&i.checked||(e="")}t&&this.currentMethod&&$("payment_form_"+this.currentMethod+"_preencrypt")&&this.changeVisible(this.currentMethod+"_preencrypt",!0),t&&this.currentMethod&&$("payment_form_"+this.currentMethod)&&this.changeVisible(this.currentMethod,!0),$("payment_form_"+e)||$("payment_form_"+e+"_preencrypt")?$("payment_form_"+e)?this.changeVisible(e,!1):this.changeVisible(e+"_preencrypt",!1):$(document.body).fire("payment-method:switched",{method_code:e}),t&&(this.currentMethod=e),this.savePaymentMethod(),"undefined"!=typeof MultiFees&&MultiFees.showPayment()},changeVisible:function(e,t){var i="payment_form_"+e;[i+"_before",i,i+"_after"].each(function(e){var i=$(e);if(i){if(i.setStyle({overflow:"hidden"}),t)MagegiantOneStepCheckout.applyMorphEffect(i,0,.5,function(){i.setStyle({display:"none"})});else{i.setStyle({display:"",height:"0px"});var s=MagegiantOneStepCheckout.getHeightFromElement(i);MagegiantOneStepCheckout.applyMorphEffect(i,s,.3,function(){i.setStyle({height:""})})}i.select("input","select","textarea","button").each(function(e){e.disabled=t})}})},savePaymentMethod:function(){var e=!0,t="payment_form_"+this.currentMethod;if([t+"_before",t,t+"_after"].each(function(t){var i=$(t);i&&Form.getElements(i).each(function(t){var i=$w(t.className);e=e&&i.all(function(e){var i=Validation.get(e);try{return Validation.isVisible(t)&&!i.test($F(t),t)?!1:!0}catch(s){return!0}})})}),e){window.payment.currentMethod=this.currentMethod;var i=Form.serialize(this.paymentMethodContainer,!0);MagegiantOneStepCheckout.Request(this.savePaymentMethodUrl,{method:"post",parameters:i})}}},MagegiantOnestepcheckoutReviewCart=Class.create(),MagegiantOnestepcheckoutReviewCart.prototype={initialize:function(e){this.removeProductLinks=$$(e.removeProductLinks),this.removeProductConfirmMessage=e.removeProductConfirmMessage,this.plusProductLinks=$$(e.plusProductLinks),this.minusProductLinks=$$(e.minusProductLinks),this.ajaxCartItemUrl=e.ajaxCartItemUrl,this.initObserver()},initObserver:function(){this.removeProductLinks.each(function(e){e.observe("click",function(e){this.onClickRemoveProductLink(e)}.bind(this))}.bind(this)),this.plusProductLinks.each(function(e){e.observe("click",function(e){this.onClickPlusProductLink(e)}.bind(this))}.bind(this)),this.minusProductLinks.each(function(e){e.observe("click",function(e){this.onClickMinusProductLink(e)}.bind(this))}.bind(this))},onClickMinusProductLink:function(e){var t=e.target.id;this._processCartItem("minus",t),e.stop},onClickPlusProductLink:function(e){var t=e.target.id;this._processCartItem("plus",t),e.stop},onClickRemoveProductLink:function(e){if(!confirm(this.removeProductConfirmMessage))return!1;var t=e.target.id;this._processCartItem("remove",t),e.stop()},_processCartItem:function(e,t){var i={method:"post",parameters:{action:e,id:t},onComplete:function(e){try{var t=e.responseText.evalJSON();!t.success&&t.error&&alert(t.error)}catch(i){}}};MagegiantOneStepCheckout.Request(this.ajaxCartItemUrl,i)}},MagegiantOnestepcheckoutReviewCoupon=Class.create(),MagegiantOnestepcheckoutReviewCoupon.prototype={initialize:function(e){this.couponContainer=$$(e.couponContainer).first(),this.couponInput=$(e.couponInput),this.applyCouponUrl=e.applyCouponUrl,this.isAppliedCoupon=e.isAppliedCoupon,this.showApplyButton=e.showApplyButton,this.applyCouponButton=$$(e.applyCouponButton).first(),this.cancelCouponButton=$$(e.cancelCouponButton).first(),this.messageContainer=$$(e.messageContainer).first(),this.errorClass=e.errorClass,this.successClass=e.successClass,this.initObserver()},initObserver:function(){this.showApplyButton?this.applyCouponButton&&(this.applyCouponButton.observe("click",function(){this.processCoupon()}.bind(this)),this.cancelCouponButton.observe("click",function(){this.processCoupon()}.bind(this))):this.couponInput&&this.couponInput.observe("change",function(){this.processCoupon()}.bind(this))},processCoupon:function(){var e=this.couponContainer;if(e.select(".validation-advice").each(function(e){e.remove()}),this._removeAllMessage(),this.showApplyButton)if(this.isAppliedCoupon)this.couponInput.setValue("");else{this.couponInput.addClassName("required-entry");var t=Validation.validate(this.couponInput);if(this.couponInput.removeClassName("required-entry"),!t)return!1}else if(!this.couponInput.getValue()&&!this.isAppliedCoupon)return!1;var i=this.messageContainer,s=this.successClass,n=this.errorClass,o=this,r={method:"post",parameters:{coupon_code:this.couponInput.getValue()},onComplete:function(e){try{var t=e.responseText.evalJSON();o.isAppliedCoupon=t.coupon_applied,t.success===!0?MagegiantOneStepCheckout.showMessage(i,t.messages,s):t.messages&&MagegiantOneStepCheckout.showMessage(i,t.messages,n)}catch(r){}o.isAppliedCoupon?(o.applyCouponButton.hide(),o.cancelCouponButton.show()):(o.applyCouponButton.show(),o.cancelCouponButton.hide());var a=MagegiantOneStepCheckout.getHeightFromElement(i);MagegiantOneStepCheckout.applyMorphEffect(i,a,.3,function(){i.setStyle({display:"none"})})}};MagegiantOneStepCheckout.Request(this.applyCouponUrl,r)},_removeAllMessage:function(){MagegiantOneStepCheckout.removeMessage(this.couponContainer,this.errorClass),MagegiantOneStepCheckout.removeMessage(this.couponContainer,this.successClass),MagegiantOneStepCheckout.applyMorphEffect(this.messageContainer,0,.5,function(){this.messageContainer.setStyle({display:"none"})}.bind(this))}},MagegiantOnestepcheckoutReviewComment=Class.create(),MagegiantOnestepcheckoutReviewComment.prototype={initialize:function(e){this.commentContainer=$$(e.commentContainer).first(),this.newRowCount=e.newRowCount||5,this.commentContainer.select("textarea").each(function(e){e.setStyle({"overflow-y":"hidden"}),this.textAreaEffectObserver(e)}.bind(this)),Form.getElements(this.commentContainer).each(function(e){e.observe("change",function(){this.saveFormData()}.bind(this))}.bind(this))},saveFormData:function(){MagegiantOneStepCheckout.saveFormData(this.commentContainer)},textAreaEffectObserver:function(e){var t=e.scrollHeight,i=parseInt(e.getAttribute("rows")),s=parseInt(e.getStyle("height"));e.observe("focus",function(){var n=i+(e.scrollHeight-t)*i/s;n<this.newRowCount?n=this.newRowCount:n++;var o=s/i*n;this.rowsAttributeEffect(e,n,o,function(){e.setStyle({"overflow-y":"auto"})})}.bind(this)),e.observe("blur",function(){var t=e.getValue().strip().length;if(0===t)this.scrollTextareaEffect(e,function(){e.setStyle({"overflow-y":"hidden"}),this.rowsAttributeEffect(e,i,s)}.bind(this));else{var n=s/i*this.newRowCount;this.scrollTextareaEffect(e,function(){e.setStyle({"overflow-y":"hidden"}),this.rowsAttributeEffect(e,this.newRowCount,n)}.bind(this))}}.bind(this))},rowsAttributeEffect:function(e,t,i,s){e.effect&&e.effect.cancel();var s=s||new Function;e.effect=new Effect.Morph(e,{style:{height:i+"px"},duration:.5,afterFinish:function(){e.setAttribute("rows",t),delete e.effect,s()}})},scrollTextareaEffect:function(e,t){e.effect&&e.effect.cancel();var t=t||new Function;return 0===e.scrollTop?void t():void new Effect.Tween(e,e.scrollTop,0,{duration:.5,afterFinish:function(){t()}},"scrollTop")}},MagegiantOnestepcheckoutReviewGiftmessage=Class.create(),MagegiantOnestepcheckoutReviewGiftmessage.prototype={initialize:function(e){this.giftMessageContainer=$$(e.giftMessageContainer).first(),this.giftMessageForm=$$(e.giftMessageForm).first(),this.useGiftmessageCheckbox=$$(e.useGiftmessageCheckbox).first(),this.isUsedGiftMessage=$$(e.isUsedGiftMessage).first(),this.inputElementIds=e.inputElementIds,this.initGiftMessage(),this.initObserver()},initGiftMessage:function(){this.useGiftmessageCheckbox&&this.processGiftMessage(this.useGiftmessageCheckbox)},initObserver:function(){this.useGiftmessageCheckbox&&this.useGiftmessageCheckbox.observe("change",function(e){this.processGiftMessage(e)}.bind(this)),this.inputElementIds.each(function(e){var t=$(e);t&&t.observe("change",function(){this.saveFormData()}.bind(this))}.bind(this))},saveFormData:function(){MagegiantOneStepCheckout.saveFormData(this.giftMessageContainer)},processGiftMessage:function(e){if("object"==typeof e){var t;t=e.target?e.target:e,t.checked?(this.isUsedGiftMessage.value=1,this.showGiftMessage()):(this.isUsedGiftMessage.value=0,this.hideGiftMessage()),this.saveFormData()}},showGiftMessage:function(){var e=this.giftMessageForm;e.setStyle({display:""});var t=MagegiantOneStepCheckout.getHeightFromElement(this.giftMessageForm);MagegiantOneStepCheckout.applyMorphEffect(this.giftMessageForm,t,.3,function(){e.setStyle({height:""})})},hideGiftMessage:function(){var e=this.giftMessageForm;MagegiantOneStepCheckout.applyMorphEffect(this.giftMessageForm,0,.5,function(){e.setStyle({display:"none"})}),this.clearInput()},clearInput:function(){this.inputElementIds.each(function(e){$(e)&&$(e).setValue("")})}},MagegiantOnestepcheckoutReviewGiftwrap=Class.create(),MagegiantOnestepcheckoutReviewGiftwrap.prototype={initialize:function(e){this.useGiftWrapCheckbox=$$(e.useGiftWrapCheckbox).first(),this.addGiftWrapUrl=e.addGiftWrapUrl,this.initObserver()},initObserver:function(){this.useGiftWrapCheckbox&&this.useGiftWrapCheckbox.observe("change",this.applyGiftWrap.bind(this))},applyGiftWrap:function(){var e={method:"post",parameters:{is_used_giftwrap:this.useGiftWrapCheckbox.getValue()}};MagegiantOneStepCheckout.Request(this.addGiftWrapUrl,e)}},MagegiantOnestepcheckoutReviewDelivery=Class.create(),MagegiantOnestepcheckoutReviewDelivery.prototype={initialize:function(e){this.deliveryContainer=$$(e.deliveryContainer).first(),this.deliveryWrapper=$$(e.deliveryWrapper).first(),this.useDeliveryCheckbox=$$(e.useDeliveryCheckbox).first(),this.isUsedDeliveryTime=$$(e.isUsedDeliveryTime).first(),this.initDelivery(),this.initObserve()},initDelivery:function(){this.handleDelivery()},initObserve:function(){this.useDeliveryCheckbox.observe("change",function(){this.handleDelivery(),this.saveFormData()}.bind(this))},handleDelivery:function(){this.useDeliveryCheckbox.getValue()?(this.isUsedDeliveryTime.value=1,this.showDelivery()):(this.isUsedDeliveryTime.value=0,this.hideDelivery())},saveFormData:function(){MagegiantOneStepCheckout.saveFormData(this.deliveryContainer)},showDelivery:function(){var e=this,t=MagegiantOneStepCheckout.getHeightFromElement(this.deliveryWrapper);this.deliveryWrapper.setStyle({display:""}),MagegiantOneStepCheckout.applyMorphEffect(this.deliveryWrapper,t,.3,function(){e.deliveryWrapper.setStyle({height:""})
})},hideDelivery:function(){var e=this;MagegiantOneStepCheckout.applyMorphEffect(e.deliveryWrapper,0,.5,function(){e.deliveryWrapper.setStyle({display:"none"})})}},MagegiantOneStepCheckoutReviewTerms=Class.create(),MagegiantOneStepCheckoutReviewTerms.prototype={initialize:function(e){this.termContainer=$$(e.termContainer).first(),this.termItemElements=$$(e.termItemElements),this.linkFromItem=e.linkFromItem,this.checkboxFromItem=e.checkboxFromItem,this.checkedFromItem=e.checkedFromItem,this.acceptTermItem=e.acceptTermItem,this.descriptionContainerFromItem=e.descriptionContainerFromItem,this.isRequiredReadTerm=e.isRequiredReadTerm,this.readTermMessage=e.readTermMessage,this.errorClass=e.errorClass,this.popup={},this.initObserver()},initObserver:function(){this.termItemElements.each(function(e){var t=e.select(this.linkFromItem).first(),i=e.select(this.checkboxFromItem).first(),s=e.select(this.checkedFromItem).first(),n=e.select(this.acceptTermItem).first(),o=e.select(this.descriptionContainerFromItem).first();if(t&&o){var r=t.id;i&&(i.checked=1==s.value?!0:!1,i.observe("click",function(e){this._removeAllMessage(),this.isRequiredReadTerm&&0==s.value&&(e.target.checked=!1,MagegiantOneStepCheckout.showMessage(this.termContainer,this.readTermMessage,this.errorClass)),s.value=e.target.checked?1:0,this.saveFormData()}.bind(this))),this.popup[r]=new MagegiantOneStepCheckoutPopup({selector:"#"+r,tinyBoxConfig:{html:o}}),n&&n.observe("click",function(){i.checked=!0,s.value=1,this._removeAllMessage(),this.popup[r].hidePopup(),this.saveFormData()}.bind(this))}}.bind(this))},_removeAllMessage:function(){this.termContainer.select(".validation-advice").each(function(e){e.remove()}),MagegiantOneStepCheckout.removeMessage(this.termContainer,this.errorClass)},saveFormData:function(){MagegiantOneStepCheckout.saveFormData(this.termContainer)}},MagegiantOneStepCheckoutForm=Class.create(),MagegiantOneStepCheckoutForm.prototype={initialize:function(e){this.checkoutForm=new VarienForm(e.checkoutForm),this.shippingMethodWrapper=e.shippingMethodWrapper,this.shippingMethodInput=e.shippingMethodInput,this.shippingMethodAdvice=e.shippingMethodAdvice,this.shippingValidationMessage=e.shippingValidationMessage,this.paymentMethodWrapper=e.paymentMethodWrapper,this.paymentMethodInput=e.paymentMethodInput,this.paymentMethodAdvice=e.paymentMethodAdvice,this.paymentValidationMessage=e.paymentValidationMessage,this.reviewCartContainer=$$(e.reviewCartContainer).first(),this.placeOrderButton=$(e.placeOrderButton),this.placeOrderUrl=e.placeOrderUrl,this.successUrl=e.successUrl,this.placeOrderButton=$(e.placeOrderButton),this.showGrandTotalAmount=e.showGrandTotalAmount,this.grandTotalAmount=this.placeOrderButton.select(e.grandTotalAmount).first(),this.grandTotalAmountProcess=this.placeOrderButton.select(e.grandTotalAmountProcess).first(),this.pleaseWaitNotice=$$(e.pleaseWaitNotice).first(),this.disabledClassName=e.disabledClassName,this.overlayClassName=e.overlayClassName,Event.fire(document,"giant_checkout:form_init_before",{form:this}),this.initObserver(),Event.fire(document,"giant_checkout:form_init_after",{form:this})},initObserver:function(){this.placeOrderButton&&this.placeOrderButton.observe("click",function(){this.placeOrderProcess()}.bind(this))},placeOrderProcess:function(){this.validate()&&(MagegiantOneStepCheckout.addOverlay(document.body,this.overlayClassName),this.showPleaseWait(),this.disablePlaceOrderButton(),this._placeOrderRequest())},_placeOrderRequest:function(){var e=Form.serialize(this.checkoutForm.form,!0),t={method:"post",parameters:e,onComplete:function(e){this.placeOrderComplete(e)}.bind(this)};new Ajax.Request(this.placeOrderUrl,t)},placeOrderComplete:function(transport){if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(Event.fire(window,"magegiant:one_step_checkout_place_order_complete",{object:this,res:response}),response.isProcess)return;if(response.redirect)return void setLocation(response.redirect);if(response.success)setLocation(this.successUrl);else if("is_hosted_pro"in response&&response.is_hosted_pro){this.popup.showPopupWithDescription(response.update_section.html),this.popup.buttons.close.enabled=!1;var iframe=this.popup.contentContainer.select("#hss-iframe").first();this.popup.container.setStyle({top:"10px"}),this.popup.contentContainer.setStyle({height:"auto"}),new MagegiantOneStepCheckoutPopup({selector:"",tinyBoxConfig:{html:response.update_section.html}}),iframe.observe("load",function(){$("hss-iframe").show(),$("iframe-warning").show()})}else if("is_centinel"in response&&response.is_centinel){new MagegiantOneStepCheckoutPopup({selector:"",tinyBoxConfig:{html:response.update_section.html}});var iframe=this.popup.contentContainer.select("#hss-iframe").first();iframe.observe("load",function(){$("centinel_authenticate_iframe").show(),$("iframe-warning").show()})}else{var msg=response.messages;"object"==typeof msg&&(msg=msg.join("\n")),msg&&alert(msg)}this.enablePlaceOrderButton(),this.hidePleaseWait(),MagegiantOneStepCheckout.removeOverlay(document.body,this.overlayClassName)}},showPleaseWait:function(){this.pleaseWaitNotice.show(),new Effect.Morph(this.pleaseWaitNotice,{style:{marginTop:"10px"},duration:.2})},hidePleaseWait:function(){this.pleaseWaitNotice.hide()},disablePlaceOrderButton:function(){this.placeOrderButton.addClassName(this.disabledClassName),this.placeOrderButton.disabled=!0},enablePlaceOrderButton:function(){this.placeOrderButton.removeClassName(this.disabledClassName),this.placeOrderButton.disabled=!1},validate:function(){var e=this.checkoutForm.validator.validate(),t=Form.serialize(this.checkoutForm.form,!0),i=this.validateShippingMethod(t),s=this.validatePaymentMethod(t),n=$$(this.shippingMethodWrapper).first(),o=$$(this.paymentMethodWrapper).first();return e&&(i?s||o.scrollTo():n.scrollTo()),e&&i&&s},validateShippingMethod:function(e){var t=!0,i=$$(this.shippingMethodAdvice).first(),s=$$(this.shippingMethodWrapper).first();return i&&s&&(e[this.shippingMethodInput]?(t=!0,i.update("").hide(),s.removeClassName("validation-failed")):(t=!1,i.update(this.shippingValidationMessage).show(),s.addClassName("validation-failed"))),t},validatePaymentMethod:function(e){var t=!0,i=$$(this.paymentMethodAdvice).first(),s=$$(this.paymentMethodWrapper).first();return i&&s&&(e[this.paymentMethodInput]?(t=!0,i.update("").hide(),s.removeClassName("validation-failed")):(t=!1,i.update(this.paymentValidationMessage).show(),s.addClassName("validation-failed"))),t}},MagegiantOneStepCheckoutCompareWishlist=Class.create(),MagegiantOneStepCheckoutCompareWishlist.prototype={initialize:function(e){this.addToContainer=$$(e.addToContainer).first(),this.addToCompareLinks=$$(e.addToCompareLinks),this.addToWishlistLinks=$$(e.addToWishlistLinks),this.productImageClass=e.productImageClass,this.addToCompareUrl=e.addToCompareUrl,this.addToWishlistUrl=e.addToWishlistUrl,this.initObserver()},initObserver:function(){this.addToCompareLinks.each(function(e){e.observe("click",function(e){this._processCompareWishlist(e,"compare")}.bind(this))}.bind(this)),this.addToWishlistLinks.each(function(e){e.observe("click",function(e){this._processCompareWishlist(e,"wishlist")}.bind(this))}.bind(this))},_processCompareWishlist:function(e,t){if("compare"==t)var i=e.target.id.split("product-compare-")[1],s=this.addToCompareUrl;else var i=e.target.id.split("product-wishlist-")[1],s=this.addToWishlistUrl;var n={method:"post",parameters:{product:i},onComplete:function(t){try{var i=t.responseText.evalJSON();e.target.up().update(i.success?i.message:i.error)}catch(s){}}};MagegiantOneStepCheckout.Request(s,n)}};